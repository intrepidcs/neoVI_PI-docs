"use strict";(self.webpackChunkneovi_pi=self.webpackChunkneovi_pi||[]).push([[734],{576:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/sudo-ip-link-056dc5443c2547b27ddba622d103a812.png"},607:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/libicsneo-socketcan-daemon-back-3be688108da555cd4699c5769eb8702a.png"},1268:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"software-setup/socketcan-kernel","title":"SocketCAN Kernel","description":"neoVI PI SocketCAN Kernel","source":"@site/docs/software-setup/socketcan-kernel.md","sourceDirName":"software-setup","slug":"/software-setup/socketcan-kernel","permalink":"/docs/neovi-pi/software-setup/socketcan-kernel","draft":false,"unlisted":false,"editUrl":"https://github.com/intrepidcs/neoVI_PI-docs/blob/main/docs/software-setup/socketcan-kernel.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"SocketCAN Kernel","description":"neoVI PI SocketCAN Kernel","keywords":["neoVI PI","Open Raspberry PI","SocketCAN Kernel"],"sidebar_position":8,"sidebar_label":"SocketCAN Kernel"},"sidebar":"tutorialSidebar","previous":{"title":"Python API","permalink":"/docs/neovi-pi/software-setup/python-api"},"next":{"title":"Control membrane LEDs and Trigger Button","permalink":"/docs/neovi-pi/control-membrane-leds-and-trigger-button"}}');var t=s(4848),c=s(8453);const r={title:"SocketCAN Kernel",description:"neoVI PI SocketCAN Kernel",keywords:["neoVI PI","Open Raspberry PI","SocketCAN Kernel"],sidebar_position:8,sidebar_label:"SocketCAN Kernel"},o="SocketCAN Kernel",d={},a=[{value:"How to use SocketCAN on a Raspberry Pi 4 (Linux) using ValueCAN 4",id:"how-to-use-socketcan-on-a-raspberry-pi-4-linux-using-valuecan-4",level:2},{value:"<strong>Hardware Setup</strong>",id:"hardware-setup",level:3},{value:"Open <strong>Terminal</strong>",id:"open-terminal",level:4},{value:"<strong>Clone Intrepid SocketCAN Kernel Module</strong> from www.github.com/intrepidcs",id:"clone-intrepid-socketcan-kernel-module-from-wwwgithubcomintrepidcs",level:4},{value:"<strong>Make the project to build the KO file</strong> by using the command make",id:"make-the-project-to-build-the-ko-file-by-using-the-command-make",level:4},{value:"<strong>Invoke CMake</strong>,",id:"invoke-cmake",level:4},{value:"<strong>Build the daemon</strong>, using the command make",id:"build-the-daemon-using-the-command-make",level:4},{value:"<strong>So to recap:</strong>",id:"so-to-recap",level:4}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"socketcan-kernel",children:"SocketCAN Kernel"})}),"\n",(0,t.jsx)(n.h2,{id:"how-to-use-socketcan-on-a-raspberry-pi-4-linux-using-valuecan-4",children:"How to use SocketCAN on a Raspberry Pi 4 (Linux) using ValueCAN 4"}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"SocketCAN",src:s(2105).A+"",title:"SocketCAN",width:"1200",height:"700"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["Intrepid Control Systems introduced an Open Source API called Libicsneo. This can be used with python_ics to integrate Intrepid vehicle networking hardware to any Python application running Linux, Mac or Windows. Please refer to ",(0,t.jsx)(n.a,{href:"https://medium.com/intrepidcontrolsystems/the-easy-way-to-program-valuecan-4-in-python-using-raspberry-pi-linux-68d160d511ef",children:"The easy way to program ValueCAN 4 in python using Raspberry Pi (Linux)"})," if you would like to learn how to program your device using Intrepid API."]}),"\n",(0,t.jsxs)(n.p,{children:["In this tutorial you will learn how to set up the Intrepid SocketCAN kernel module on your Raspberry Pi 4 to work with any Intrepid tool such as ValueCAN 4 series. Please reference the documentation for a list of supported hardware. We will be using ",(0,t.jsx)(n.a,{href:"https://www.intrepidcs.com/products/vehicle-network-adapters/valuecan-4/valuecan-4-2-overview/",children:"ValueCAN 4\u20132"})," that includes two channels of CAN or CAN FD."]}),"\n",(0,t.jsx)(n.h3,{id:"hardware-setup",children:(0,t.jsx)(n.strong,{children:"Hardware Setup"})}),"\n",(0,t.jsxs)(n.p,{children:["Connect ValueCAN 4\u20132 using DB-9F to OBD-II cable to ",(0,t.jsx)(n.a,{href:"https://www.intrepidcs.com/products/ecu-simulators/",children:"neoOBD2 Simulator"})," (optional) to receive or transmit CAN or CAN FD messages instead of a car."]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"hw-setuo",src:s(3832).A+"",title:"hw-setup",width:"1400",height:"972"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.h4,{id:"open-terminal",children:["Open ",(0,t.jsx)(n.strong,{children:"Terminal"})]}),"\n",(0,t.jsxs)(n.p,{children:["Install ",(0,t.jsx)(n.strong,{children:"dkms"}),", the package for ",(0,t.jsx)(n.strong,{children:"Dynamic Kernel Module Support Framework"}),". We need the dkms package for Raspberry Pi because it doesn\u2019t have a kernel header. On Ubuntu, this is accomplished by running:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install linux-headers-generic build-essential gcc git \r\n\r\nsudo apt-get install dkms\r\n\r\nsudo apt install raspberrypi-kernel-headers\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"dkms-Y",src:s(3441).A+"",title:"dkms-Y",width:"674",height:"472"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.h4,{id:"clone-intrepid-socketcan-kernel-module-from-wwwgithubcomintrepidcs",children:[(0,t.jsx)(n.strong,{children:"Clone Intrepid SocketCAN Kernel Module"})," from ",(0,t.jsx)(n.a,{href:"http://www.github.com/intrepidcs",children:"www.github.com/intrepidcs"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/intrepidcs/intrepid-socketcan-kernel-module.git\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"intrepid-socketcan-kernel-module",src:s(4680).A+"",title:"intrepid-socketcan-kernel-module",width:"1398",height:"455"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsx)(n.p,{children:"Go to the module directory by using:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd intrepid-socketcan-kernel-module\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"make-the-project-to-build-the-ko-file-by-using-the-command-make",children:[(0,t.jsx)(n.strong,{children:"Make the project to build the KO file"})," by using the command make"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"intrepid-ko",src:s(9540).A+"",title:"intrepid-ko",width:"666",height:"464"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["The resulting file will be ",(0,t.jsx)(n.strong,{children:"intrepid.ko"}),". This module depends on can, can_dev, and can_raw. We have a script to help within the makefile, make reload. But If you prefer to run it yourself, you can run using the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo modprobe can\r\n\r\nsudo modprobe can_raw\r\n\r\nsudo modprobe can_dev\r\n\r\nsudo insmod intrepid.ko\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"lsmod"})," to ",(0,t.jsx)(n.strong,{children:"confirm the module is loaded"}),"."]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"module-loaded",src:s(2732).A+"",title:"module-loaded",width:"638",height:"170"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["If you wish to have the module auto-load on boot, then please follow the instructions on our GitHub page at ",(0,t.jsx)(n.a,{href:"https://github.com/intrepidcs/intrepid-socketcan-kernel-module",children:"https://github.com/intrepidcs/intrepid-socketcan-kernel-module"}),". Once you have the Intrepid Socket Kernel Module setup, then we will need to install ",(0,t.jsx)(n.strong,{children:"icsscand"}),". Intrepid Icsscand is a user-mode SocketCAN daemon for Intrepid devices."]}),"\n",(0,t.jsxs)(n.p,{children:["To keep our file system clean, we will move out of the Intrepid SocketCAN Kernel directory by using ",(0,t.jsx)(n.code,{children:"cd.."})," command."]}),"\n",(0,t.jsx)(n.p,{children:"To install the dependencies needed we will run"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install git cmake gcc libusb-1.0-0-dev libpcap-dev build-essential\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"libpcap-dev",src:s(1389).A+"",title:"libpcap-dev",width:"661",height:"216"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["Once you have the dependencies installed, then ",(0,t.jsx)(n.strong,{children:"clone icsscand repository recursively by running"}),"\\"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone --recursive https://github.com/intrepidcs/icsscand.git\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"icsscand",src:s(7776).A+"",title:"icsscand",width:"691",height:"327"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["Switch into the cloned directory, ",(0,t.jsx)(n.code,{children:"cd icsscand"})," and ",(0,t.jsx)(n.strong,{children:"make a build directory"})," and switch into it, ",(0,t.jsx)(n.code,{children:"mkdir build && cd build"})]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"icsscand",src:s(2272).A+"",title:"icsscand",width:"699",height:"344"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.h4,{id:"invoke-cmake",children:[(0,t.jsx)(n.strong,{children:"Invoke CMake"}),","]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cmake .. -DCMAKE_BUILD_TYPE=Release \n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"cmake",src:s(9003).A+"",title:"cmake",width:"681",height:"181"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.h4,{id:"build-the-daemon-using-the-command-make",children:[(0,t.jsx)(n.strong,{children:"Build the daemon"}),", using the command make"]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"command-make",src:s(3654).A+"",title:"command-make",width:"743",height:"458"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["Daemon should now be available as ",(0,t.jsx)(n.strong,{children:"libicsneo-socketcan-daemon"}),". Daemon allows you to run Intrepid devices in the background. To start the daemon program use"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo ./libicsneo-socketcan-daemon\n"})}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"libicsneo-socketcan-daemon",src:s(6479).A+"",title:"libicsneo-socketcan-daemon",width:"730",height:"455"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["If you\u2019re happy with the results and would like to run in the background, run ",(0,t.jsx)(n.code,{children:"sudo ./libicsneo-socketcan-daemon -d"})," to run in daemon mode."]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"libicsneo-socketcan-daemon-back",src:s(607).A+"",title:"libicsneo-socketcan-daemon-back",width:"737",height:"449"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["To ",(0,t.jsx)(n.strong,{children:"view your CAN interfaces"}),", use the command, ",(0,t.jsx)(n.code,{children:"sudo ip link"}),". They will be labeled can0, can1, and etc. They will have an alias listed which corresponds to the serial number of the device and network on that device. To ",(0,t.jsx)(n.strong,{children:"enable the CAN interface to transmit and receive"})," with ",(0,t.jsx)(n.code,{children:"sudo ip link set up can0"}),", replacing can0 with whichever interface you\u2019d like to enable"]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"sudo-ip-link",src:s(576).A+"",title:"sudo-ip-link",width:"685",height:"455"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsxs)(n.p,{children:["You can now use any SocketCAN application with this interface. A good package for testing is the ",(0,t.jsx)(n.strong,{children:"can-utils"})," package. You can get this with ",(0,t.jsx)(n.code,{children:"sudo apt install can-utils"}),". A good testing tool which comes with this package is ",(0,t.jsx)(n.strong,{children:"candump"}),". Running ",(0,t.jsx)(n.code,{children:"candump can0"})," will print a line for every incoming frame."]}),"\n",(0,t.jsx)("div",{class:"text--center",children:(0,t.jsxs)("figure",{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"can-utils",src:s(2940).A+"",title:"can-utils",width:"655",height:"449"})}),(0,t.jsx)("figcaption",{})]})}),"\n",(0,t.jsx)(n.h4,{id:"so-to-recap",children:(0,t.jsx)(n.strong,{children:"So to recap:"})}),"\n",(0,t.jsxs)(n.p,{children:["Install ",(0,t.jsx)(n.strong,{children:"Intrepid SocketCAN Kernel Module"})]}),"\n",(0,t.jsxs)(n.p,{children:["Install and start ",(0,t.jsx)(n.strong,{children:"SocketCAN daemon for Intrepid devices."})]}),"\n",(0,t.jsxs)(n.p,{children:["View and enable the ",(0,t.jsx)(n.strong,{children:"correct CAN Interface"})]}),"\n",(0,t.jsxs)(n.p,{children:["You can read ",(0,t.jsx)(n.strong,{children:"intrepid-socketcan-kernel-module"})," at ",(0,t.jsx)(n.a,{href:"https://github.com/intrepidcs/intrepid-socketcan-kernel-module",children:"https://github.com/intrepidcs/intrepid-socketcan-kernel-module"})," and ",(0,t.jsx)(n.strong,{children:"icsscand"})," ",(0,t.jsx)(n.a,{href:"https://github.com/intrepidcs/icsscand",children:"https://github.com/intrepidcs/icsscand"})]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1389:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/libpcap-dev-859bb533b5493c5be3cecc5311ebaf1b.png"},2105:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/SocketCAN-928936196dac571f23e7bdb7cd1d6b62.png"},2272:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cd-icsscand-866c8d3ee6684c595f6dcc376c148520.png"},2732:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/module-loaded-c382abaa9f41905f7d8820b03ecc9368.png"},2940:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/can-utils-71208149356ad2b683190e6f74336ddb.png"},3441:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/dkms-Y-d89111600caa3e48a44b9b352006b0c8.png"},3654:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/command-make-2ce0fa5f2dd0117be6d13d422dff7ed0.png"},3832:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/1QnNZKQo4ZByo8utFJXX3rg-ef2473df00377a1c67af4371e409969d.png"},4680:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/intrepid-socketcan-kernel-module-b1d8b266e08ef8d63a07ca6986b87cbd.png"},6479:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/libicsneo-socketcan-daemon-2e6cd9ef3ca0af4f82cb0be240ae18dc.png"},7776:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/icsscand-134c7e6e977374062d1f4d7a781aae9d.png"},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var i=s(6540);const t={},c=i.createContext(t);function r(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(c.Provider,{value:n},e.children)}},9003:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/cmake-061ecb3729a1ed5db0dfca993f47a811.png"},9540:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/intrepid-ko-d9c95203ff1452f64f649c79db2de972.png"}}]);